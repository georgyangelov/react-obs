syntax = "proto3";

package protocol;

message ClientMessage {
    oneof message {
        InitRequest init_request = 1;
        ApplyUpdates apply_updates = 2;
    }
}

message ServerMessage {
    oneof message {
        InitResponse init_response = 1;
    }
}

message InitRequest {
    string client_id = 1;
}

message InitResponse {
    uint32 canvas_width = 1;
    uint32 canvas_height = 2;

    repeated Scene scenes = 3;
}

message Scene {
    string name = 1;
}

message ApplyUpdates {
    repeated Update updates = 1;
}

message Update {
    oneof change {
        CreateElement create_element = 1;
        AppendChild append_child = 2;
    }
}

//
// Update Types
//

enum ElementType {
    TEXT = 0;
    BOX = 1;
}

message CreateElement {
    ElementType type = 1;
    string name = 2;
    map<string, PropValue> props = 3;
}

message AppendChild {
    string parent_name = 1;
    string child_name = 2;
}

//
// Common
//

message PropValue {
    oneof value {
        string string_value = 1;
        int64 int_value = 2;
        double float_value = 3;
        bool bool_value = 4;
        MapProp map_value = 5;
    }
}

message MapProp {
    map<string, PropValue> map = 1;
}
